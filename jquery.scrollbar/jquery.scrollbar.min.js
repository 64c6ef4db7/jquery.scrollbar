/**
 * jQuery Custom Scrollbar plugin
 *
 * Copyright 2013, Yuriy Khabarov
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * If you found bug, please contact me via email <13real008@gmail.com>
 *
 * @author Yuriy Khabarov aka Gromo
 * @version 1.1
 * @url https://github.com/gromo/dslib/tree/master/jquery.scrollbar
 *
 * TODO:
 *  - refactor scroll emulate on scrollbar mousewheel
 */
(function(e,t,n){function c(){var t={border:"none",height:"100px",margin:"0",padding:"0",width:"100px"};var n=e("<div>").css(e.extend({},t));var i=e("<div>").css(e.extend({background:"#F00",left:"-200px",overflow:"scroll",position:"absolute",top:"-200px"},t)).append(n).appendTo("body").scrollLeft(n.width()).scrollTop(n.height());var s={height:i.offset().top-n.offset().top||0,width:i.offset().left-n.offset().left||0};if(r.webkit){s.height=0;s.width=0}i.remove();return s}var r={mobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent),webkit:n.WebKitPoint?true:false,log:function(t,r){var i=t;if(r&&typeof t!="string"){i=[];e.each(t,function(e,t){i.push('"'+e+'": '+t)});i=i.join(", ")}if(n.console&&n.console.log){n.console.log(i)}},scroll:null};var i=false;var s="px";var o=[];var u={autoScrollSize:true,duration:200,ignoreMobile:true,showArrows:true,type:"advanced",scrollx:null,scrolly:null,onInit:null,onDestroy:null};var a=function(t,n){if(!r.scroll){r.scroll=c();r.log("Custom Scrollbar v1.1")}this.container=t;this.options=e.extend({},u);this.scrollx={};this.scrolly={};if(!(r.mobile&&this.options.ignoreMobile))this.init(n)};a.prototype={destroy:function(){if(!this.wrapper){return}var n=this.container.scrollLeft();var r=this.container.scrollTop();this.container.insertBefore(this.wrapper).css({height:"",margin:""}).removeClass("scroll-content").removeClass("scroll-scrollx_show").removeClass("scroll-scrolly_show").off(".scrollbar").scrollLeft(n).scrollTop(r);this.scrollx.scrollbar.hide().find("div").andSelf().off(".scrollbar");this.scrolly.scrollbar.hide().find("div").andSelf().off(".scrollbar");this.wrapper.remove();e(t).add("body").off(".scrollbar");if(e.isFunction(this.options.onDestroy))this.options.onDestroy.apply(this,[this.container])},getScrollbar:function(t){var n=this.options["scroll"+t];var r={advanced:'<div class="scroll-arrow scroll-arrow_less"></div>'+'<div class="scroll-arrow scroll-arrow_more"></div>'+'<div class="scroll-element_outer">'+'    <div class="scroll-element_size"></div>'+'    <div class="scroll-element_inner-wrapper">'+'        <div class="scroll-element_inner">'+'            <div class="scroll-element_inner-bottom"></div>'+"        </div>"+"    </div>"+'    <div class="scroll-bar">'+'        <div class="scroll-bar_body">'+'            <div class="scroll-bar_body-inner"></div>'+"        </div>"+'        <div class="scroll-bar_bottom"></div>'+'        <div class="scroll-bar_center"></div>'+"    </div>"+"</div>",simple:'<div class="scroll-element_outer">'+'    <div class="scroll-element_size"></div>'+'    <div class="scroll-element_inner"></div>'+'    <div class="scroll-bar">'+"    </div>"+"</div>"};var i=r[this.options.type]?this.options.type:"advanced";if(n){if(typeof n=="string"){n=e(n).appendTo(this.wrapper)}else{n=e(n)}}else{n=e("<div>").addClass("scroll-element").html(r[i]).appendTo(this.wrapper)}if(this.options.showArrows){n.addClass("scroll-element_show-arrows")}return n.addClass("scroll-"+t)},init:function(n){function c(t,n){var i="scroll-scroll"+t+"_show";var u=t=="x"?a.y:a.x;var l=parseInt(o.css(t=="x"?"left":"top"))||0;var h=n.size;var p=n.visible+l;n.isVisible=h>p;if(n.isVisible){n.scrollbar.show();u.scrollbar.addClass(i);o.addClass(i)}else{n.scrollbar.hide();u.scrollbar.removeClass(i);o.removeClass(i)}if(t=="y"){o.css("height",n.isVisible?p+r.scroll.height+s:"auto")}if(a.x.size!=o.prop("scrollWidth")||a.y.size!=o.prop("scrollHeight")||a.x.visible!=f.width()||a.y.visible!=f.height()||a.x.offset!=(parseInt(o.css("left"))||0)||a.y.offset!=(parseInt(o.css("top"))||0)){e.each(a,function(t,n){e.extend(n,t=="x"?{offset:parseInt(o.css("left"))||0,size:o.prop("scrollWidth"),visible:f.width()}:{offset:parseInt(o.css("top"))||0,size:o.prop("scrollHeight"),visible:f.height()})});c(t=="x"?"y":"x",u)}}var i=this;var o=this.container;var u=e.extend(this.options,n);var a={x:this.scrollx,y:this.scrolly};var f=this.wrapper;var l={scrollLeft:o.scrollLeft(),scrollTop:o.scrollTop()};if(!f){this.wrapper=f=o.wrap(e("<div>").css({position:o.css("position")=="absolute"?"absolute":"relative"}).addClass("scroll-wrapper").addClass(o.attr("class"))).parent();o.addClass("scroll-content").css({height:"auto","margin-bottom":r.scroll.height*-1+s,"margin-right":r.scroll.width*-1+s}).on("scroll.scrollbar",function(){a.x.isVisible&&a.x.scroller.css("left",o.scrollLeft()*a.x.kx+s);a.y.isVisible&&a.y.scroller.css("top",o.scrollTop()*a.y.kx+s)})}else{o.css({height:"auto"})}e.each(a,function(n,r){if(!r.scrollbar){r.scrollbar=i.getScrollbar(n);r.scroller=r.scrollbar.find(".scroll-bar");var s=function(e){var t=n=="x"?"scrollLeft":"scrollTop";var r=e.originalEvent.wheelDelta||-e.originalEvent.detail;o[t](o[t]()-r).scroll();e.preventDefault()};r.scrollbar.on({"DOMMouseScroll.scrollbar":s,"mousewheel.scrollbar":s});r.scrollbar.find(".scroll-arrow").on("mousedown.scrollbar",function(){var t=e(this).hasClass("scroll-arrow_more")?30:-30;var r=n=="x"?"scrollLeft":"scrollTop";var i={};i[r]=o[r]()+t;o.animate(i,u.duration)});r.scrollbar.find(".scroll-element_inner").on("click.scrollbar",function(e){var t=n=="x"?"scrollLeft":"scrollTop";var i=e[n=="x"?"pageX":"pageY"]<r.scroller.offset()[n=="x"?"left":"top"]?-1:1;var s={};s[t]=o[t]()+r.visible*i;o.animate(s,u.duration)});r.scroller.on("mousedown.scrollbar",function(i){var s=n=="x"?"scrollLeft":"scrollTop";var u=i[n=="x"?"pageX":"pageY"];var a=o[s]();r.scrollbar.addClass("scroll-draggable");var f=function(e){e.preventDefault();return false};var l=function(){e(t).add("body").off(".scrollbar");r.scrollbar.removeClass("scroll-draggable")};e(t).on({"blur.scrollbar":l,"dragstart.scrollbar":f,"mousemove.scrollbar":function(e){var t=parseInt((e[n=="x"?"pageX":"pageY"]-u)/r.kx);o[s](a+t)},"mouseup.scrollbar":l});e("body").on({"selectstart.scrollbar":f});i.preventDefault();return false})}});e.each(a,function(e,t){var n="scroll-scroll"+e+"_show";var r=e=="x"?a.y:a.x;t.scrollbar.hide();r.scrollbar.removeClass(n);o.removeClass(n)});e.each(a,function(t,n){e.extend(n,t=="x"?{offset:parseInt(o.css("left"))||0,size:o.prop("scrollWidth"),visible:f.width()}:{offset:parseInt(o.css("top"))||0,size:o.prop("scrollHeight"),visible:f.height()})});e.each(a,c);e.each(a,function(e,t){var n=e=="x"?"left":"top";var r=e=="x"?"width":"height";var i=parseInt(o.css(n))||0;var a=t.size;var f=t.visible+i;t.scrollbar.css(r,t.visible+s);var l=t.scrollbar.find(".scroll-element_size");l=l[r]()+parseInt(l.css(n)||0);if(u.autoScrollSize){t.scrollbarSize=parseInt(l*f/a);t.scroller.css(r,t.scrollbarSize+s)}t.scrollbarSize=parseInt(t.scroller.css(r));t.kx=(l-t.scrollbarSize)/(a-f)||1});if(e.isFunction(u.onInit))u.onInit.apply(this,[o]);o.scrollLeft(l.scrollLeft).scrollTop(l.scrollTop).trigger("scroll")}};e.fn.scrollbar=function(t,n){var r=this;if(t=="get")r=null;this.each(function(){var i=e(this);if(i.hasClass("scroll-wrapper")||i.get(0).nodeName=="body"){return}var s=i.data("scrollbar");if(s){if(t==="get"){r=s;return false}t=typeof t=="string"&&s[t]?t:"init";s[t].apply(s,e.isArray(n)?n:[]);if(t=="destroy"){i.removeData("scrollbar");while(e.inArray(s,o)>=0)o.splice(e.inArray(s,o),1)}}else{if(typeof t!="string"){s=new a(i,t);i.data("scrollbar",s);o.push(s)}}});return r};var f=0;var l=setInterval(function(){var e,t,n,s,u,a;for(e=0;e<o.length;e++){n=o[e];t=n.container;s=n.wrapper;u=n.scrollx;a=n.scrolly;if(s.is(":visible")&&(t.prop("scrollWidth")!=u.size||t.prop("scrollHeight")!=a.size||s.width()!=u.visible||s.height()!=a.visible)){n.init();if(i){r.log({scrollHeight:t.prop("scrollHeight")+":"+n.scrolly.size,scrollWidth:t.prop("scrollWidth")+":"+n.scrollx.size,visibleHeight:s.height()+":"+n.scrolly.visible,visibleWidth:s.width()+":"+n.scrollx.visible},true);if(f++>100){r.log("Scroll udpates exceed 100");clearInterval(l)}}}}},300)})(jQuery,document,window)